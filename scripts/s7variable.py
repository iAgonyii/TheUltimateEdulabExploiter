
import os
import sys
sys.path.append('./scripts/isf')
from icssploit.clients.s7_client import S7Client

ip_400 = os.environ["s7_400"]
target = S7Client(name="S7-400", ip=ip_400, rack=0, slot=3)
try:
    print('\033[46;1mS7-400 PLC - ' + ip_400 + ':\033[0m')
    target.connect()
    location = [tuple(os.environ["s7readlocation"].split(",")) + (2,)]
    data = target.read_var(location)[0]
    print('\033[36;1mFound PLC variables: ' + str(data[0]) + ', ' + str(data[1]) + '\033[0m')
    writeLocation = [tuple(os.environ["s7readlocation"].split(",")) + ([data[0], data[1]],)]
    target.write_var(writeLocation)
except:
    print('\033[41;1mSomething went wrong while connecting to ' + ip_400 + '\033[0m')

ip_1500 = os.environ["s7_1500"]
target2 = S7Client(name="S7-1500", ip=ip_1500, rack=0, slot=3)
try:
    print('\033[46;1mS7-400 PLC - ' + ip_1500 + ':\033[0m')
    target2.connect()
    location = [tuple(os.environ["s7readlocation"].split(",")) + (2,)]
    data = target.read_var(location)[0]
    print('\033[36;1mFound PLC variables: ' + str(data[0]) + ', ' + str(data[1]) + '\033[0m')
    writeLocation = [tuple(os.environ["s7readlocation"].split(",")) + ([data[0], data[1]],)]
    target.write_var(writeLocation)
except:
    print('\033[41;1mSomething went wrong while connecting to ' + ip_1500 + '\033[0m')

